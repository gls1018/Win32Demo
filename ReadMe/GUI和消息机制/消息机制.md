**消息定义**

```cpp
struct MSG
{
    HWND hwnd;
    UINT message;
    WPARAM wPara;
    LPARAM lPara;
    DWORD time;
    POINT pt;
};
```

一个消息结构体由6部分组成:

- 窗口句柄
- 消息ID
- wPara附带信息
- lPara附带信息
- 消息产生的时间
- 消息产生时鼠标的位置



**线程消息队列**

当线程第一次调用GDI函数的时候，系统会为线程创建消息队列，非GUI线程是没有消息队列的。



**系统消息队列**





一个鼠标点击的消息从产生到被窗口过程处理，有以下步骤

- 鼠标设备驱动程序根据用户事件，转换成消息放到Windows系统消息队列
- Windows将系统消息队列取出，投放到消息所属的线程消息队列
- 应用程序的消息循环从线程消息队列中取出消息传递给窗口过程
- 窗口过程处理消息























**消息循环**

```cpp
MSG msg;
while(GetMessage(&msg),NULL, 0,0)
{
    TranslateMessage(&msg);
    DispatchMessage(&msg);
}
```





### 相关API



#### GetMessage

从调用者线程消息队列中取出一个消息

```cpp
BOOL GetMessage(
    LPMSG lpMsg;
    HWND hWnd;
    UINT wMsgFilterMin;
    UINT wMsgFilterMax;
)
```

- 传出参数，填充MSG结构体
- 窗口句柄，表示从哪个句柄的窗口中抓取消息，如果是NULL,则会获取所有窗口的消息(一个线程中可能不止一个窗口)
- 要检索的最低消息的整数值
- 要检索的最大消息的整数值
- 返回值: 如果抓取的消息是WM_QUIT,则返回0.



#### PeekMessage

```cpp
PeekMessage(
    LPMSG lpMsg,
    HWND hWnd,
    UINT wMsgFilterMin,
    UINT wMsgFilterMax,
    UINT wRemoveMsg
)
```

前面四个参数作用和GetMessage相同。

- wRemoveMsg
  - PM_NOREMOVE：只是看一下消息，不会从消息队列中移除
  - PM_REMOVE: 取出消息，然后从消息队列中移除
  - PM_NOYIELD
- 返回值：队列中有消息返回TRUE,无消息返回FALSE.



GetMessage和PeekMessage的对比

- GetMessage是阻塞的，队列中无消息时，会一直阻塞，直到有消息
- PeekMessage是非阻塞的，队列中无消息时，直接返回FALSE,执行后续代码







#### TranslateMessage







































